<div class="base">
    <div class="char-header-main">
        <div class="">
            <div class="char-header-fieldline"><input type="text" class="char-name-input" name="attr_characterName" value="" placeholder="Enter Name"></div>
            <div class="char-header-fieldline">
                <input type="text" class="char-race-input" name="attr_race" placeholder="Enter Race">
                <input type="text" class="char-class-input" name="attr_characterClass" value="" placeholder="Enter Class">
            </div>
            
        </div>
        <div class="char-header-stats">
                <span>Size</span>
                <input type="number" name="attr_size" class="char-small-num-input" value="1">
                <span>Weight</span>
                <input type="number" name="attr_weight" class="char-small-num-input" value="1">
                <span>Reach</span>
                <input type="number" name="attr_reach" class="char-small-num-input" value="1">
                <span>Speed</span>
                <input type="number" name="attr_speed" class="char-small-num-input" value="5">
                <span>Stability</span>
                <input type="number" name="attr_stability" class="char-small-num-input" value="0">
                <span>Renoun</span>
                <input type="number" name="attr_renoun" class="char-small-num-input" value="0">
                <span>Level</span>
                <input type="number" name="attr_level" class="char-small-num-input"  value="0">
                <span></span>
                <span></span>                        
        </div>
    </div>

    <!-- Middle Area -->
    <div class="char-header-main">
        <div class="middle-header-2col">
            <!-- Character Stats -->
            <div class="sheet-middle">
                <div class="sheet-section-title">Attributes and Skills</div>
                <div class="char-stats-5col">
                    <span class="attrib-button-holder"><button type="action" name="act_test" class="attrib-button" value="MGT">MGT</button></span>
                    <span class="attrib-button-holder"><button type="action" name="act_test" class="attrib-button" value="AGL">AGL</button></span>
                    <span class="attrib-button-holder"><button type="action" name="act_test" class="attrib-button" value="REA">REA</button></span>
                    <span class="attrib-button-holder"><button type="action" name="act_test" class="attrib-button" value="INU">INU</button></span>
                    <span class="attrib-button-holder"><button type="action" name="act_test" class="attrib-button" value="PRS">PRS</button></span>

                    <span class="attrib-button-holder"><input type="number" name="attr_mgt" class="attrib-input" value="0"></span>
                    <span class="attrib-button-holder"><input type="number" name="attr_agl" class="attrib-input" value="0"></span>
                    <span class="attrib-button-holder"><input type="number" name="attr_rea" class="attrib-input" value="0"></span>
                    <span class="attrib-button-holder"><input type="number" name="attr_inu" class="attrib-input" value="0"></span>
                    <span class="attrib-button-holder"><input type="number" name="attr_prs" class="attrib-input" value="0"></span>
                </div> 
            </div>
            <!-- Banes and Edges -->
            <div class="bane-grid sheet-middle">
                <div class="bane-top-level edge-container">
                    <!-- Rectangular switch -->
                     Edge
                    <label class="switch">
                        <input type="checkbox" name="attr_edge">
                        <span class="slider_green"></span>
                    </label>
                </div>
                <div class="bane-top-level bane-container">
                    Bane
                    <!-- Rectangular switch -->
                    <label class="switch">
                        <input type="checkbox" name="attr_bane">
                        <span class="slider_red"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Button Row -->
     <div class="sheet-section">
        
        <div class="button-holder">
            <button type="action" name="act_actions" class="sheet-button">Actions</button>
            <button type="action" name="act_skills" class="sheet-button">Skills</button>
            <button type="action" name="act_kit" class="sheet-button">Kit</button>
            <button type="action" name="act_background" class="sheet-button">Background</button>
        </div>
     </div>

     <!-- *******************************************************************************************************************
     ********************************************* Abilities Tab **************************************************************
     ********************************************************************************************************************-->

    <input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="actions" />
    <div class="sheet-actions">
        <div class="char-top-layout-3col">
            <div class="sheet-generic">
                

                
                <!-- Stamina and Recovery -->
                <div class="sheet-section sheet-stam-recover">
                    <!-- Stamina -->
                    <div class="sheet-stam-recover-inner">
                        <div class="sheet-stam-recover-main">
                            <div class="sheet-section-title">Stamina</div>
                            <input type="number" class="bignum" name="attr_stamina">
                        </div>
                        <div class="sheet-stam-recover-second">
                            <div class="sheet-stam-recover-2col">
                                <span>Max:</span><input type="number" name="attr_maxstamina" class="small-num-input">
                            </div>
                            <div class="sheet-stam-recover-2col">
                                <span>Winded:</span><input type="hidden" name="attr_halfstamina"><input type="text" name="attr_halfstamina2" value="@{halfstamina}" class="info-input" disabled>
                            </div>
                        </div>
                    </div>
                    <!-- Recovery -->
                    <div class="sheet-stam-recover-inner">
                        <div class="sheet-stam-recover-main">
                            <div class="sheet-section-title">Recoveries</div>
                            <input type="number" class="bignum" name="attr_recoveries">
                        </div>
                        <div class="sheet-stam-recover-second">
                            <div class="sheet-stam-recover-2col">
                                <span>Max:</span><input type="number" name="attr_maxrecoveries" class="small-num-input">
                            </div>
                            <div class="sheet-stam-recover-2col">
                                <span>Half:</span><input type="hidden" name="attr_halfrecoveries"><input type="text" name="attr_halfstamina2" value="@{halfrecoveries}" class="info-input" disabled>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Victories -->
                <div class="sheet-section">
                    <div class="sheet-section-title">Victories</div>
                    <div class="sheet-vicres-holder">
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="vic-container"><input type="checkbox"><span class="checkmark"></span></label>
                        
                    </div>
                </div>
                <!-- Resources -->
                <div class="sheet-section">
                    <div class="sheet-section-title">Resources</div>
                    <div class="sheet-vicres-holder">
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        <label class="res-container"><input type="checkbox"><span class="checkmark"></span></label>
                        
                    </div>
                </div>
            </div>

            <!-- Second Main Column -->
            <div  class="sheet-generic">

                <!-- Attacks repeating section -->
                <div class="sheet-section">
                    <div class="sheet-section-title">Actions</div>
                    <fieldset class="repeating_attacks">
                        <div class="sheet-repholder">
                            <div class="sheet-reptitle">
                                <input type="text" name="attr_atknamedisp" value="@{atkname}" class="info-input" disabled="true">
                                <input type="text" name="attr_atknamedisp" value="@{atkcost}" class="cost-input" disabled="true">
                                <button type="action" name="act_attackroll" id="atkrollbutton" class="rptactionbutton">Roll</button>
                                <button type="roll" name="roll_atksummaryroll" id="atksummarybutton" 
                                            value="&{template:drawsteelsummary}{{mod=@{mods}}}{{name=Action: @{atkname}}}{{type=@{atktype}}}{{cost=@{atkcost}}}{{dist=@{atkdistance}}}{{targ=@{atktarget}}}{{t1d=@{atktier1dmg}}}{{t1e=@{atktier1desc}}}{{t2d=@{atktier2dmg}}}{{t2e=@{atktier2desc}}}{{t3d=@{atktier3dmg}}}{{t3e=@{atktier3desc}}}{{eft=@{atkeffect}}}" 
                                            class="rptactionbutton">Chat</button>
                                <span></span>
                            </div>
                            <input class="clicktohide" type="checkbox">
                            <div class="sheet-hiddenarea">
                                <div class="rpt_2col">
                                    <span>Name:</span><input type="text" name="attr_atkname" placeholder="Attack Name">
                                    <span>Modifier</span>
                                    <select name="attr_mods">
                                        <option>MGT</option>
                                        <option>AGL</option>
                                        <option>REA</option>
                                        <option>INU</option>
                                        <option>PRS</option>
                                    </select>
                                    <span>Attack Type</span>
                                    <select name="attr_atktype">
                                        <option>Melee</option>
                                        <option>Ranged</option>
                                        <option>Magic</option>
                                    </select>
                                    <span>Cost</span><input type="text" name="attr_atkcost" placeholder="Cost to use">
                                    <span>Distance:</span><input type="text" name="attr_atkdistance" placeholder="Distance">
                                
                                    <span>Target:</span><input type="text" name="attr_atktarget" placeholder="One Target">
                                </div>
                                <div class="rpt_3col"> 
                                    <span></span><span>Damage</span><span>Special</span>
                                    <span>Tier 1</span><span><input type="number" name="attr_atktier1dmg" class="small-val-input" value="0"></span ><input type="text" name="attr_atktier1desc" value="" placeholder="Special Effect">
                                    <span>Tier 2</span><span><input type="number" name="attr_atktier2dmg" class="small-val-input" value="0"></span><span><input type="text" name="attr_atktier2desc" value="" placeholder="Special Effect"></span>
                                    <span>Tier 3</span><span><input type="number" name="attr_atktier3dmg" class="small-val-input" value="0"></span><span><input type="text" name="attr_atktier3desc" value="" placeholder="Special Effect"></span>
                                </div>
                                <div class="">
                                    <span>Effect</span><br/>
                                    <textarea name="attr_atkeffect" class="effect-text-area">
                                </div>
                            </div>

                        </div>
                    </fieldset>
                </div>

                <!--  Triggered Actions Repeating section -->
                <div class="sheet-section">
                    <div class="sheet-section-title">Triggered Actions</div>
                    <fieldset class="repeating_triggers">
                        <div class="sheet-repholder">
                            <div class="sheet-reptitle">
                                <input type="text" name="attr_trgnamedis" value="@{trgtrigger} >> @{trgname}" class="info-input" disabled="true">
                                <span></span>
                                <span></span>
                                <button type="roll" name="roll_triggerroll" id="trgrollbutton" class="rptactionbutton" value="&{template:drawsteelsummary}{{name=Trigger: @{trgname}}}{{trigger=@{trgtrigger}}}{{eft=@{trgdesc}}}">Chat</button>
                            </div>
                            <input class="clicktohide" type="checkbox">
                            <div class="sheet-hiddenarea">
                                <div class="sheet-generic-2col">
                                    <span>Action Name:</span><input type="text" name="attr_trgname">
                                    <span>Trigger:</span><input type="text" name="attr_trgtrigger">
                                </div>
                                <span>Effect</span>
                                <textarea name="attr_trgdesc" class="effect-text-area">
                            </div>
                        </div>
                    </fieldset>
                </div>

                <!--  Maneuvers Repeating section -->
                <div class="sheet-section">
                    <div class="sheet-section-title">Maneuvers</div>
                    <fieldset class="repeating_maneuvers">
                        <div class="sheet-repholder">
                            <div class="sheet-reptitle">
                                <input type="text" name="attr_mannamedisp" value="@{manname}" class="info-input" disabled="true">
                                <input type="text" name="attr_mannamedisp" value="@{mancost}" class="cost-input" disabled="true">
                                <button type="action" name="act_maneuverroll" id="manrollbutton" class="rptactionbutton">Roll</button>
                                <button type="roll" name="roll_maneuversummaryroll" id="mansummarybutton" 
                                            value="&{template:drawsteelsummary}{{mod=@{manmods}}}{{name=Maneuver: @{manname}}}{{type=@{mantype}}}{{cost=@{mancost}}}{{dist=@{mandistance}}}{{targ=@{mantarget}}}{{t1=@{mantier1desc}}}{{t2=@{mantier2desc}}}{{t3=@{mantier3desc}}}{{eft=@{maneffect}}}" 
                                            class="rptactionbutton">Chat</button>
                            </div>
                            <input class="clicktohide" type="checkbox">
                            <div class="sheet-hiddenarea">
                                <div class="rpt_2col">
                                    <span>Name:</span><input type="text" name="attr_manname" placeholder="Maneuver Name">
                                    <span>Modifier</span>
                                    <select name="attr_manmods">
                                        <option>MGT</option>
                                        <option>AGL</option>
                                        <option>REA</option>
                                        <option>INU</option>
                                        <option>PRS</option>
                                    </select>
                                    <span>Attack Type</span>
                                    <select name="attr_mantype">
                                        <option>Melee</option>
                                        <option>Ranged</option>
                                        <option>Magic</option>
                                    </select>
                                    <span>Cost</span><input type="text" name="attr_mancost" placeholder="Cost to use">
                                    <span>Distance:</span><input type="text" name="attr_mandistance" placeholder="Distance">
                                
                                    <span>Target:</span><input type="text" name="attr_mantarget" placeholder="One Target">
                                </div>
                                <div>Results</div>
                                <div class="rpt_2col"> 
                                    <span>Tier 1</span><input type="text" name="attr_mantier1desc" value="" placeholder="Effect">
                                    <span>Tier 2</span><input type="text" name="attr_mantier2desc" value="" placeholder="Effect">
                                    <span>Tier 3</span><input type="text" name="attr_mantier3desc" value="" placeholder="Effect">
                                </div>
                                <div class="">
                                    <span>Effect</span><br/>
                                    <textarea name="attr_maneffect" class="effect-text-area">
                                </div>
                            </div>

                        </div>
                    </fieldset>
                </div>

                <!--  Abilities Repeating section -->
                <div class="sheet-section">
                    <div class="sheet-section-title">Abilities</div>
                    <fieldset class="repeating_abilities">
                        <div class="sheet-repholder">
                            <div class="sheet-reptitle">
                                <input type="text" name="attr_ablnamedis" value="@{ablname}" class="info-input" disabled="true">
                                <span></span>
                                <span></span>
                                <button type="roll" name="roll_abilityroll" id="ablrollbutton" class="rptactionbutton" value="&{template:drawsteelsummary}{{name=Ability: @{ablname}}}{{eft=@{abldesc}}}">Chat</button>
                            </div>
                            <input class="clicktohide" type="checkbox">
                            <div class="sheet-hiddenarea">
                                <div>
                                    <span>Ability Name:</span><input type="text" name="attr_ablname">
                                </div>
                                <span>Description</span>
                                <textarea name="attr_abldesc" class="effect-text-area">
                            </div>
                        </div>
                    </fieldset>
                </div>

            </div>

            
        </div>
    </div>

    <!-- *******************************************************************************************************************
     ********************************************* Skills Tab **************************************************************
     ********************************************************************************************************************-->

    <input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="actions" />
    <div class="sheet-skills">
        <!-- Skills -->
        <div class="sheet-generic-2col">
            <div class="skills-column">
                <div class="sheet-section">
                    <div class="sheet-section-title">
                        Crafting Skills
                    </div>
                    <div class="sheet-skill-top">
                        <button name="act_skill" type="action" value="Alchemy" class="skillbutton">Alchemy</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_alchemy"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Architecture" class="skillbutton">Architecture</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_architecture"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Blacksmithing" class="skillbutton">Blacksmithing</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_blacksmithing"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Fletching" class="skillbutton">Fletching</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_fletching"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Jewelry" class="skillbutton">Jewelry</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_jewelry"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Mechanics" class="skillbutton">Mechanics</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_mechanics"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Tailoring" class="skillbutton">Tailoring</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_tailoring"><span class="skill-checkmark"></span></label>
                    </div>

                </div>

                <div class="sheet-section">
                    <div class="sheet-section-title">
                        Exploration Skills
                    </div>
                    <div class="sheet-skill-top">
                        <button name="act_skill" type="action" value="Climb" class="skillbutton">Climb</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_climb"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Drive" class="skillbutton">Drive</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_drive"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Endurance" class="skillbutton">Endurance</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_endurance"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Gymnastics" class="skillbutton">Gymnastics</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_gymnastics"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Heal" class="skillbutton">Heal</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_heal"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Jump" class="skillbutton">Jump</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_jump"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="List" class="skillbutton">Lift</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_lift"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Navigate" class="skillbutton">Navigate</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_navigate"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Ride" class="skillbutton">Ride</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_ride"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Swim" class="skillbutton">Swim</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_swim"><span class="skill-checkmark"></span></label>
                    </div>

                </div>

                <div class="sheet-section">
                    <div class="sheet-section-title">
                        Interpersonal Skills
                    </div>
                    <div class="sheet-skill-top">
                        <button name="act_skill" type="action" value="Brag" class="skillbutton">Brag</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_brag"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Empathize" class="skillbutton">Empathize</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_empathize"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Flirt" class="skillbutton">Flirt</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_flirt"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Gamble" class="skillbutton">Gamble</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_gamble"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Handle_Animals" class="skillbutton">Handle Animals</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_handle_animals"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Interrogate" class="skillbutton">Interrogate</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_interrogate"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Intimidate" class="skillbutton">Intimidate</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_intimidate"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Lead" class="skillbutton">Lead</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_lead"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Lie" class="skillbutton">Lie</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_lie"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Music" class="skillbutton">Music</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_music"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Persuade" class="skillbutton">Persuade</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_persuade"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Read_Person" class="skillbutton">Read Person</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_read_person"><span class="skill-checkmark"></span></label>
                    </div>

                </div>

            </div>
            <div class="skills-column">
                
                <div class="sheet-section">
                    <div class="sheet-section-title">
                        Intrigue Skills
                    </div>
                    <div class="sheet-skill-top">
                        <button name="act_skill" type="action" value="Alertness" class="skillbutton">Alertness</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_alertness"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Conceal" class="skillbutton">Conceal Object</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_conceal"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Disguise" class="skillbutton">Disguise</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_disguise"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Eavesdrop" class="skillbutton">Eavesdrop</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_eavesdrop"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Escape" class="skillbutton">Escape Artist</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_escape"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Hide" class="skillbutton">Hide</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_interrogate"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Performance" class="skillbutton">Performance</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_intimidate"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Pick" class="skillbutton">Pick Lock</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_pick"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Pocket" class="skillbutton">Pick Pocket</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_pocket"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Sabotage" class="skillbutton">Sabotage</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_sabotage"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Search" class="skillbutton">Search</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_search"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Sneak" class="skillbutton">Sneak</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_sneak"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Track" class="skillbutton">Track</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_track"><span class="skill-checkmark"></span></label>
                    </div>

                </div>
                
                <div class="sheet-section">
                    <div class="sheet-section-title">
                        Lore Skills
                    </div>
                    <div class="sheet-skill-top">
                        <button name="act_skill" type="action" value="Culture" class="skillbutton">Culture</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_culture"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Underworld" class="skillbutton">Criminal Underworkd</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_underworld"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="History" class="skillbutton">History</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_history"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Magic" class="skillbutton">Magic</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_magic"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Monsters" class="skillbutton">Monsters</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_monsters"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Nature" class="skillbutton">Nature</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_nature"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Psionics" class="skillbutton">Psionics</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_psionics"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Religion" class="skillbutton">Religion</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_religion"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Rumors" class="skillbutton">Rumors</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_rumors"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Society" class="skillbutton">Society</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_society"><span class="skill-checkmark"></span></label>
                        <button name="act_skill" type="action" value="Timescape" class="skillbutton">Timescape</button>
                        <label class="skill-container"><input type="checkbox" name="attr_skill_timescape"><span class="skill-checkmark"></span></label>
                    </div>

                </div>

            </div>
        </div>
    </div>

    <!-- *******************************************************************************************************************
     ********************************************* Kit Tab **************************************************************
     ********************************************************************************************************************-->

    <input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="actions" />
    <div class="sheet-kit">
        <div class="sheet-kit-top-2col">
            <div class="sheet-kit-top-level">
                <div class="sheet-section">
                    <div><span>Kit Name:</span><input type="text" name="attr_kitname"></div>
                </div>
                <div class="sheet-section">
                    <div class="sheet-section-title">Damage Modifications</div>
                    <div class="sheet-kit-damage-grid">
                        <span></span>
                        <span>Melee</span>
                        <span>Ranged</span>
                        <span>Magic</span>
                        <span>Tier 1</span>
                        <input type="number" name="attr_kitt1melee" value="0" class="kit-damage">
                        <input type="number" name="attr_kitt1range" value="0" class="kit-damage">
                        <input type="number" name="attr_kitt1magic" value="0" class="kit-damage">
                        <span>Tier 2</span>
                        <input type="number" name="attr_kitt2melee" value="0" class="kit-damage">
                        <input type="number" name="attr_kitt2range" value="0" class="kit-damage">
                        <input type="number" name="attr_kitt2magic" value="0" class="kit-damage">
                        <span>Tier 3</span>
                        <input type="number" name="attr_kitt3melee" value="0" class="kit-damage">
                        <input type="number" name="attr_kitt3range" value="0" class="kit-damage">
                        <input type="number" name="attr_kitt3magic" value="0" class="kit-damage">
                    </div>
                </div>
                <div class="sheet-section">
                    <div class="sheet-generic-2col">
                        <div class="sheet-generic-2col">
                            <span>Area+ </span><input type="number" name="attr_kitarea" value="0">
                            <span>Distance+ </span><input type="number" name="attr_kitdistance" value="0">
                            <span>Reach+ </span><input type="number" name="attr_kitreach" value="0">
                        </div>
                        <div class="sheet-generic-2col">
                            <span>Stability+ </span><input type="number" name="attr_kitstability" value="0">
                            <span>Stamina+ </span><input type="number" name="attr_kitstamina" value="0">
                            <span>speed+ </span><input type="number" name="attr_kitspeed" value="0">
                        </div>
                    </div>
                </div>
                <div class="">
                    <button type="roll" id="kitroll" class="kitrollbutton"
                            value="&{template:drawsteelsummary}{{name=Kit Info: @{kitname}}}{{kt1e=@{kitt1melee}}}{{kt1r=@{kitt1range}}}{{kt1m=@{kitt1magic}}}{{kt2e=@{kitt2melee}}}{{kt2r=@{kitt2range}}}{{kt2m=@{kitt2magic}}}{{kt3e=@{kitt3melee}}}{{kt3r=@{kitt3range}}}{{kt3m=@{kitt3magic}}}{{karea=@{kitarea}}}{{kdist=@{kitdistance}}}{{kreach=@{kitreach}}}{{kstability=@{kitstability}}}{{kstamina=@{kitstamina}}}{{kspeed=@{kitspeed}}}{{eft=@{kitdesc}}}{{mob=@{kitmobility}}}{{eqp=@{kitequip}}}"
                            >Send Kit Info to Chat</button>
                </div>
            </div>

            <div class="sheet-kit-top-level">
                <div class="sheet-section">
                    <div class="sheet-section-title">Description</div>
                    <div><textarea name="attr_kitdesc" class="kit-bigtextarea"></div>
                </div>
                <div class="sheet-section">
                    <div class="sheet-section-title">Equipment</div>
                    <div><textarea name="attr_kitequip" class="kit-smalltextarea"></div>
                </div>
                <div class="sheet-section">
                    <div class="sheet-section-title">Mobility</div>
                    <div><textarea name="attr_kitmobility" class="kit-smalltextarea"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- *******************************************************************************************************************
     ********************************************* Ancestry Tab **************************************************************
     ********************************************************************************************************************-->
     <input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="actions" />
    <div class="sheet-background">
        <div class="sheet-generic-2col">
            <span>Career</span>
            <input type="text" name="attr_career" value="" placeholder="Enter Career">
            <span>Complications</span>
            <input type="text" name="attr_complication" value="" placeholder="Enter Complication">
            <span>Languages</span>
            <input type="text" name="attr_languages" value="" placeholder="Enter Languages">
            <span>Ancestry</span>
            <input type="text" name="attr_ancestry" value="" placeholder="Enter Ancestry">
        </div>
    </div>
    
</div>

</div>


<!-- TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES TEMPLATES -->

<!-- Attribute Roll Template -->
<rolltemplate class="sheet-rolltemplate-drawsteelbasic">
    <div class="sheet-template-title">
        {{#char-name}}
        <span>{{char-name}}: </span>
        {{/char-name}}
        <span> {{roll-type}}</span>
        <span>{{roll}}</span>
    </div>
    <div class="sheet-template-body">
        {{#rollGreater() computed::critical 0}}<div class="sheet-template-crit">Critical</div>{{/rollGreater() computed::critical 0}}
        {{#rollLess() roll 12}}<div class="sheet-template-result">Tier 1 Result</div>{{/rollLess() roll 12}}
        {{#rollBetween() roll 12 16}}<div class="sheet-template-result">Tier 2 Result</div>{{/rollBetween() roll 12 16}}
        {{#rollGreater() roll 16}}<div class="sheet-template-result">Tier 3 Result</div>{{/rollGreater() roll 16}}
    </div>
</rolltemplate>

<!-- Action/Attack Roll Template -->
<rolltemplate class="sheet-rolltemplate-drawsteelattack">
    <div class="sheet-template-title">
        {{#char-name}}
        <span>{{char-name}}: </span>
        {{/char-name}}
        <span> {{roll-type}}</span>
        <span>{{roll}}</span>
    </div>
    <div class="sheet-template-body">
        {{#rollGreater() computed::critical 0}}<div class="sheet-template-crit">Critical</div>{{/rollGreater() computed::critical 0}}
        {{#rollLess() roll 12}}
            <div class="sheet-template-result">
                <div class="sheet-template-tier"><span>Tier 1 Result</span></div>
                <div class="sheet-template-damage"><span>Damage: </span><span>{{t1dmg}}</span></div>
                {{#t1desc}}<div class="sheet-template-desc"><span>{{t1desc}}</span></div>{{/t1desc}}
            </div>
        {{/rollLess() roll 12}}
        {{#rollBetween() roll 12 16}}
            <div class="sheet-template-result">
                <div class="sheet-template-tier"><span>Tier 2 Result</span></div>
                <div class="sheet-template-damage"><span>Damage: </span><span>{{t2dmg}}</span></div>
                {{#t2desc}}<div class="sheet-template-desc"><span>{{t2desc}}</span></div>{{/t2desc}}
            </div>
        {{/rollBetween() roll 12 16}}
        {{#rollGreater() roll 16}}
            <div class="sheet-template-result">
                <div class="sheet-template-tier"><span>Tier 3 Result</span></div>
                <div class="sheet-template-damage"><span>Damage: </span><span>{{t3dmg}}</span></div>
                {{#t3desc}}<div class="sheet-template-desc"><span>{{t3desc}}</span></div>{{/t3desc}}
            </div>
        {{/rollGreater() roll 16}}
    </div>
    {{#effect}}
        <div class="sheet-template-special">
            {{effect}}
        </div>
    {{/effect}}
</rolltemplate>

<!-- Maneuver Roll Template -->
<rolltemplate class="sheet-rolltemplate-drawsteelmaneuver">
    <div class="sheet-template-title">
        {{#char-name}}
        <span>{{char-name}}: </span>
        {{/char-name}}
        <span> {{roll-type}}</span>
        <span>{{roll}}</span>
    </div>
    <div class="sheet-template-body">
        {{#rollGreater() computed::critical 0}}<div class="sheet-template-crit">Critical</div>{{/rollGreater() computed::critical 0}}
        {{#rollLess() roll 12}}
            <div class="sheet-template-result">
                <div class="sheet-template-tier"><span>Tier 1 Result</span></div>
                {{#t1eff}}<div class="sheet-template-desc"><span>{{t1eff}}</span></div>{{/t1eff}}
            </div>
        {{/rollLess() roll 12}}
        {{#rollBetween() roll 12 16}}
            <div class="sheet-template-result">
                <div class="sheet-template-tier"><span>Tier 2 Result</span></div>
                {{#t2eff}}<div class="sheet-template-desc"><span>{{t2eff}}</span></div>{{/t2eff}}
            </div>
        {{/rollBetween() roll 12 16}}
        {{#rollGreater() roll 16}}
            <div class="sheet-template-result">
                <div class="sheet-template-tier"><span>Tier 3 Result</span></div>
                {{#t3eff}}<div class="sheet-template-desc"><span>{{t3eff}}</span></div>{{/t3eff}}
            </div>
        {{/rollGreater() roll 16}}
    </div>
    {{#effect}}
        <div class="sheet-template-special">
            {{effect}}
        </div>
    {{/effect}}
</rolltemplate>

<!-- Ability Roll Template -->
<rolltemplate class="sheet-rolltemplate-drawsteelability">
    <div class="sheet-template-title">
        {{name}}
    </div>
    <div class="sheet-template-result">
        {{description}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-drawsteeltrigger">
    <div class="sheet-template-title">
        {{name}}
    </div>
    <div class="sheet-template-result">
        {{trigger}}
    </div>
    <div class="sheet-template-result">
        {{description}}
    </div>
</rolltemplate>

<!-- To Chat Summary Template-->
<rolltemplate class="sheet-rolltemplate-drawsteelsummary">
    <div class="sheet-template-title">
        {{#name}}
        <span>{{name}}</span>
        {{/name}}
    </div>
    {{#type}}
        <div class="sheet-template-summary-2col">
            {{#type}}
            <span>Ability Type:</span><span> {{type}}</span>
            {{/type}}
            {{#mod}}
            <span>Attribute Modifier:</span><span> {{mod}}</span>
            {{/mod}}
            {{#cost}}
            <span>Ability Cost:</span><span> {{cost}}</span>
            {{/cost}}
            {{#dist}}
            <span>Distance:</span><span> {{dist}}</span>
            {{/dist}}
            {{#targ}}
            <span>Target:</span><span> {{targ}}</span>
            {{/targ}}
            {{#trigger}}
            <span>Trigger:</span><span> {{trigger}}</span>
            {{/trigger}}
        </div>
    {{/type}}
    {{#trigger}}
        <div class="sheet-template-summary-2col">
            <span>Trigger:</span><span> {{trigger}}</span>
        </div>
    {{/trigger}}
    {{#t1}}
        <div class="sheet-template-summary-2col">
            <span>Tier 1:</span><span>{{t1}}</span>
            <span>Tier 2:</span><span>{{t2}}</span>
            <span>Tier 3:</span><span>{{t3}}</span>
        </div>
    {{/t1}}
    {{#t1d}}
        <div class="sheet-template-summary-3col">
            <span>Tier 1:</span><span>{{t1d}}</span><span>{{t1e}}</span>
            <span>Tier 2:</span><span>{{t2d}}</span><span>{{t2e}}</span>
            <span>Tier 3:</span><span>{{t3d}}</span><span>{{t3e}}</span>
        </div>
    {{/t1d}}

    {{#kt1e}}
    <div class="sheet-template-special">Stat Modifications</div>
    <div class="sheet-template-summary-4col">
        <span>Area</span><span>{{karea}}</span><span>Stability</span><span>{{kstability}}</span>
        <span>Distance</span><span>{{kdist}}</span><span>Stamina</span><span>{{kstamina}}</span>
        <span>Reach</span><span>{{kreach}}</span><span>Speed</span><span>{{kspeed}}</span>
    </div>
    <div class="sheet-template-special">Damage Modifications</div>
    <div class="sheet-template-summary-4col">
        <span></span><span>Melee</span><span>Ranged</span><span>Magic</span>
        <span>Tier 1</span><span>{{kt1e}}</span><span>{{kt1r}}</span><span>{{kt1m}}</span>
        <span>Tier 2</span><span>{{kt2e}}</span><span>{{kt2r}}</span><span>{{kt2m}}</span>
        <span>Tier 3</span><span>{{kt3e}}</span><span>{{kt3r}}</span><span>{{kt3m}}</span>
    </div>
    {{/kt1e}}
    {{#eft}}
        <div class="sheet-template-special">{{eft}}</div>
    {{/eft}}
    {{#mob}}
        <div class="sheet-template-special"><span>Mobility: </span>{{mob}}</div>
    {{/mob}}
    {{#eqp}}
        <div class="sheet-template-special"><span>Equipment: </span>{{eqp}}</div>
    {{/eqp}}
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-test">
    Full Roll = {{roll1}} <br />
    Critical? = {{computed::critical}}<br />
</rolltemplate>

<!-- SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS SCRIPTS-->
<script type="text/worker">

    ////////////////////////////////////////////////////////////////
    //  Tabs!
    ////////////////////////////////////////////////////////////////
    const buttonlist = ["actions", "skills", "kit", "background"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function(event) {
            console.log("in tab button click")
            setAttrs({
                sheetTab: button
            });
        });
    });

    ////////////////////////////////////////////////////////////////
    //  Abilities Test Roll!
    ////////////////////////////////////////////////////////////////

    on ('clicked:test', (event) => {
        testRoll(event.htmlAttributes.value);
    });
    
    
    const testRoll = (rollExp) => {

        console.log(rollExp);

        // construct the die roll
        let rollVal = "[[2d10+@{"+rollExp+"}";
        let baneVal = "";
        let edgeVal = "";
        let totalRoll = "";

        getAttrs(["bane", "edge"], 
        function(values) {
            baneVal = values["bane"];
            console.log("Bane is " + baneVal);
            edgeVal = values["edge"];
            console.log("Edge is " + edgeVal);

            if (edgeVal == "on"){rollVal = rollVal + " + 2 [Edge]"};
            if (baneVal == "on"){rollVal = rollVal + " - 2 [Bane]"};
    
            rollVal = rollVal +"]]";
    
            // Construct the roll
            totalRoll = "&{template:drawsteelbasic}{{char-name=@{characterName}}}{{roll-type="+rollExp+"}}{{roll="+rollVal+"}}{{critical=[[0]]}}";
    
            console.log("Roll text = " + totalRoll);

            // Get rid of edge and bane
            edgeOff();

            startRoll(totalRoll, (results) => {
                console.log("In Generic startRoll");
                rolldata = {};
                rolldata.critical = isCrit(results.results.roll.dice[0], results.results.roll.dice[1]);
                finishRoll(results.rollId, rolldata);
            });
        });

    } 

    ////////////////////////////////////////////////////////////////
    //  Attacks Roll!
    ////////////////////////////////////////////////////////////////

    on ('clicked:repeating_attacks', (event) => {
        console.log("Starting event in repeating_attacks");
        console.log(event);
        
        const rowid = getRowID(event);
        // Get the fields
        
        getAttrs([
            "repeating_attacks_"+rowid+"_mods",
            "repeating_attacks_"+rowid+"_atktype",
            "edge",
            "bane",
        ], function(values){
            let rollVal = "2d10";
            rollVal = rollVal + "+@{" + values["repeating_attacks_"+rowid+"_mods"] + "}";
            if (values["edge"] == "on"){rollVal = rollVal + " + 2 [Edge]";};
            if (values["bane"] == "on"){rollVal = rollVal + " - 2 [Bane]";};

            let damType = values["repeating_attacks_"+rowid+"_atktype"];

            rollText="&{template:drawsteelattack}"+
                        "{{roll=[[" + rollVal + "]]}}"+
                        "{{char-name=@{characterName}}}"+
                        "{{roll-type=@{repeating_attacks_"+rowid+"_atkname}}}"+
                        "{{critical=[[0]]}}"+
                        "{{t1dmg=[[" + getTierDamage(1, damType, rowid) + "]]}}"+
                        "{{t2dmg=[[" + getTierDamage(2, damType, rowid) + "]]}}"+
                        "{{t3dmg=[[" + getTierDamage(3, damType, rowid) + "]]}}"+
                        "{{t1desc=@{repeating_attacks_"+rowid+"_atktier1desc}}}"+
                        "{{t2desc=@{repeating_attacks_"+rowid+"_atktier2desc}}}"+
                        "{{t3desc=@{repeating_attacks_"+rowid+"_atktier3desc}}}"+
                        "{{effect=@{repeating_attacks_"+rowid+"_atkeffect}}}";

            
            // Get rid of edge and bane
            edgeOff();

            attackRoll(rollText);

        });
            
         
    });

    const attackRoll = (rollText) => {
        startRoll(rollText, (results) => {
            console.log("In Attack startRoll");
            rolldata = {};
            rolldata.critical = isCrit(results.results.roll.dice[0], results.results.roll.dice[1]);
            console.log(results);
            finishRoll(results.rollId, rolldata);
        });
    }

    // Figure out the damage formula for a given type and tier
    function getTierDamage(tierNum, damType, rowID) {
        //Get the damage for the attack in question for the given tier
        let txtRtn = "@{repeating_attacks_"+rowID+"_atktier"+tierNum+"dmg} [Base]"
        if (damType == "Melee"){
            txtRtn = txtRtn + " + @{kitt"+tierNum+"melee} [Kit]";
        }else{
            if (damType == "Ranged"){
                txtRtn = txtRtn + " + @{kitt"+tierNum+"range} [Kit]";
            }else{
                txtRtn = txtRtn + " + @{kitt"+tierNum+"magic} [Kit]";
            }
        }
        return txtRtn;
    }

    ////////////////////////////////////////////////////////////////
    //  Maneuvers Roll!
    ////////////////////////////////////////////////////////////////

    on ('clicked:repeating_maneuvers', (event) => {
        console.log("Starting event in repeating_maneuvers");
        console.log(event);
        
        const rowid = getRowID(event);
        
        // Get the fields
        getAttrs([
            "repeating_maneuvers_"+rowid+"_manmods",
            "repeating_maneuvers_"+rowid+"_mantype",
            "edge",
            "bane",
        ], function(values){
            let rollVal = "2d10";
            rollVal = rollVal + "+@{" + values["repeating_maneuvers_"+rowid+"_manmods"] + "}";
            if (values["edge"] == "on"){rollVal = rollVal + " + 2 [Edge]";};
            if (values["bane"] == "on"){rollVal = rollVal + " - 2 [Bane]";};

            let damType = values["repeating_attacks_"+rowid+"_atktype"];

            rollText="&{template:drawsteelmaneuver}"+
                        "{{roll=[[" + rollVal + "]]}}"+
                        "{{char-name=@{characterName}}}"+
                        "{{roll-type=@{repeating_maneuvers_"+rowid+"_manname}}}"+
                        "{{critical=[[0]]}}"+
                        "{{t1eff=@{repeating_maneuvers_"+rowid+"_mantier1desc}}}"+
                        "{{t2eff=@{repeating_maneuvers_"+rowid+"_mantier2desc}}}"+
                        "{{t3eff=@{repeating_maneuvers_"+rowid+"_mantier3desc}}}"+
                        "{{effect=@{repeating_maneuvers_"+rowid+"_maneffect}}}";

            
            // Get rid of edge and bane
            edgeOff();

            attackRoll(rollText);

        });
            
         
    });


    //////////////////////////////////////////////////////////
    // Recalc Stamina
    //////////////////////////////////////////////////////////

    on('change:maxstamina change:maxrecoveries', function() {
        console.log('Max Stamina Triggered');
        // Change the half-stamina control
        getAttrs(["maxstamina", "maxrecoveries"], function(values){
            let hsta =Math.round(values["maxstamina"]/2);
            let hrec = Math.round(values["maxrecoveries"]/2);
            console.log("Half stamina is "+hsta);
            setAttrs({halfstamina: hsta, halfrecoveries: hrec});
        });
    });

    //////////////////////////////////////////////////////////
    // Ability Repeating Area Roll
    //////////////////////////////////////////////////////////
    on ('clicked:repeating_abilities', (event) => {
        console.log("Starting event in repeating_abilities");
        console.log(event);
        
        // Get the rowId
        const rowid = getRowID(event);
        
        // Get the fields
        
        rollText="&{template:drawsteelability}"+
                        "{{name=@{repeating_abilities_"+rowid+"_ablname}}}"+
                        "{{description=@{repeating_abilities_"+rowid+"_abldesc}}}";

        startRoll(rollText, (results) => {
            console.log("In Skill startRoll");
            rolldata = {};
            finishRoll(results.rollId, rolldata);
        });

  
    });

    //////////////////////////////////////////////////////////
    // Trigger Repeating Area Roll
    //////////////////////////////////////////////////////////
    on ('clicked:repeating_triggers', (event) => {
        console.log("Starting event in repeating_triggers");
        console.log(event);
        
        // Get the rowId
        const rowid = getRowID(event);
        
        // Get the fields
        
        rollText="&{template:drawsteeltrigger}"+
                        "{{name=@{repeating_triggers_"+rowid+"_trgname}}}"+
                        "{{trigger=@{repeating_triggers_"+rowid+"_trgtrigger}}}"+
                        "{{description=@{repeating_triggers_"+rowid+"_trgdesc}}}";

        startRoll(rollText, (results) => {
            console.log("In Skill startRoll");
            rolldata = {};
            finishRoll(results.rollId, rolldata);
        });

  
    });

    //////////////////////////////////////////////////////////
    // Skill roll
    //////////////////////////////////////////////////////////
    on ('clicked:skill', (event) => {
        skillRoll(event.htmlAttributes.value);
    });

    const skillRoll = (value) => {
        console.log(value + " skill roll");
        let skillName = value.toLowerCase();
        let rollText = "2d10";
        let rollVal = "";
        
        getAttrs([
            "skill_"+skillName,
            "edge",
            "bane",
        ], function(values){
            if(values["skill_"+skillName] == "on"){rollText = rollText +" +2 [Skilled]";}
            if(values["edge"] == "on"){rollText = rollText +" +2 [Edge]";}
            if(values["bane"] == "on"){rollText = rollText +" -2 [Bane]";}

            // Get rid of edge and bane
            edgeOff();

            rollVal = "&{template:drawsteelbasic}{{roll-type="+value+" Skill}}{{roll=[["+rollText+"]]}}{{critical=[[0]]}}";

            startRoll(rollVal, (results) => {
                console.log("In Skill startRoll");
                rolldata = {};
                rolldata.critical = isCrit(results.results.roll.dice[0], results.results.roll.dice[1]);
                console.log(results);
                finishRoll(results.rollId, rolldata);
            });
        });
    }

    ////////////////////////////////////////////
    //  Utilitiy fucntions
    ////////////////////////////////////////////
    function getRowID(event){
        const trigger = event.sourceAttribute.split('_');
        const rowid = trigger[2];
        console.log("Row ID: " + rowid);
        return rowid;
    }

    function isCrit(num1, num2){
        if((num1+num2)>18){
            console.log("Crit!")
            return 1;
        }else{
            return 0;
        }
    }

    function edgeOff(){
        //Take the edge and bane off
            setAttrs({
                bane: 0,
                edge: 0
            });
    }

</script>